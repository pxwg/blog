---
const { entry, locale, llmTranslated } = Astro.props;

// Extract current slug from URL path
const currentPath = Astro.url.pathname;
// Handle both prefixed (/en/article/slug) and non-prefixed (/article/slug) routes
const currentSlug = currentPath.replace(/^\/(zh|en)?\/article\//, '').replace(/\/$/, '');

// If the slug still contains '/article/', it means we're in the non-prefixed route
// and need to extract the slug differently
const finalSlug = currentSlug.includes('/article/')
  ? currentSlug.replace(/^\/article\//, '')
  : currentSlug;

// Check if this is an LLM-translated article using front matter or direct prop
const isLLMTranslated = entry?.data?.['llm-translated'] === true || llmTranslated === true;

const targetLocale = locale === 'zh' ? 'en' : 'zh';

// Generate target path using Astro's i18n routing
let targetPath = null;
if (isLLMTranslated) {
  targetPath = `/${targetLocale}/article/${finalSlug}/`;
}
---
{isLLMTranslated && targetPath && (
  <div class="translation-disclaimer">
    {locale === 'zh' ? (
      <span>
        📝 翻译声明：本文由 LLM 从原文翻译而来，可能存在翻译不准确之处。建议阅读 <a href={targetPath}>原文</a> 以获得最准确的内容。
      </span>
    ) : (
      <span>
        📝 Translation Notice: This article was translated from the original by LLM and may contain inaccuracies. Please refer to the <a href={targetPath}>original article</a> for the most accurate content.
      </span>
    )}
  </div>
)}

<style>
.translation-disclaimer {
  margin: 0.75em 0;
  padding: 0.75em 0.9em;
  border-left: 3px solid var(--accent);
  background: var(--raw-bg-color);
  border-radius: 6px;
  color: var(--gray-color);
  font-size: 0.9em;
  line-height: 1.35;
}
.translation-note-title {
  color: var(--accent);
  font-weight: 600;
  margin-right: 0.3em;
}
.translation-disclaimer a {
  color: var(--accent);
  text-decoration: underline;
}
.translation-disclaimer a:hover {
  color: var(--accent-dark);
  opacity: 0.9;
}
</style>
